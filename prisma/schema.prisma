generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  password                String
  name                    String
  role                    UserRole                 @default(INDIVIDUAL)
  bio                     String?
  experienceYears         Int?
  skills                  String[]
  industry                String?
  isPremium               Boolean                  @default(false)
  companyId               String?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  viewCount               Int                      @default(0)
  coverImage              String?
  image                   String?
  isOpenToWork            Boolean                  @default(false)
  openToWorkPreferences   Json?
  accountStatus           UserStatus               @default(ACTIVE)
  aiQueries               AIQuery[]
  careerInsights          CareerInsight[]
  certifications          Certification[]
  comments                Comment[]
  followedCompanies       CompanyFollow[]
  receivedConnections     Connection[]             @relation("ReceivedConnections")
  sentConnections         Connection[]             @relation("SentConnections")
  education               Education[]
  givenEndorsements       Endorsement[]            @relation("GivenEndorsements")
  receivedEndorsements    Endorsement[]            @relation("ReceivedEndorsements")
  eventsParticipating     EventParticipant[]
  experience              Experience[]
  groupMemberships        GroupMember[]
  jobsPosted              Job[]
  jobApplications         JobApplication[]
  languages               Language[]
  sentMessages            Message[]
  newsletters             Newsletter[]
  newsletterSubs          NewsletterSubscription[]
  notifications           Notification[]
  posts                   Post[]
  reactions               Reaction[]
  givenRecommendations    Recommendation[]         @relation("GivenRecommendations")
  receivedRecommendations Recommendation[]         @relation("ReceivedRecommendations")
  reports                 Report[]
  savedPosts              SavedPost[]
  subscriptions           Subscription[]
  company                 Company?                 @relation(fields: [companyId], references: [id])
  badges                  UserBadge[]
  followedTags            UserTagFollow[]

  @@index([email])
  @@index([companyId])
}

model Company {
  id          String          @id @default(cuid())
  name        String          @unique
  industry    String?
  description String?
  locations   String[]
  verified    Boolean         @default(false)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  followers   CompanyFollow[]
  events      Event[]
  jobs        Job[]
  posts       Post[]
  employees   User[]

  @@index([name])
}

model Post {
  id           String       @id @default(cuid())
  postType     PostType
  title        String
  content      String
  tags         String[]
  mediaUrl     String?
  mediaType    String?
  isPromoted   Boolean      @default(false)
  viewCount    Int          @default(0)
  authorId     String?
  companyId    String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  isPublished  Boolean      @default(true)
  scheduledFor DateTime?
  groupId      String?
  newsletterId String?
  attachments  Attachment[]
  comments     Comment[]
  author       User?        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  company      Company?     @relation(fields: [companyId], references: [id], onDelete: Cascade)
  group        Group?       @relation(fields: [groupId], references: [id], onDelete: Cascade)
  newsletter   Newsletter?  @relation(fields: [newsletterId], references: [id])
  hashtags     PostTag[]
  reactions    Reaction[]
  savedBy      SavedPost[]

  @@index([postType])
  @@index([authorId])
  @@index([companyId])
  @@index([groupId])
  @@index([createdAt])
}

model Group {
  id          String        @id @default(cuid())
  name        String
  description String
  industry    String?
  location    String?
  rules       String?
  type        GroupType     @default(PUBLIC)
  logo        String?
  coverImage  String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  events      Event[]
  members     GroupMember[]
  polls       Poll[]
  posts       Post[]

  @@index([name])
}

model GroupMember {
  id       String    @id @default(cuid())
  userId   String
  groupId  String
  role     GroupRole @default(MEMBER)
  joinedAt DateTime  @default(now())
  group    Group     @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, groupId])
  @@index([userId])
  @@index([groupId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
}

model Reaction {
  id        String       @id @default(cuid())
  type      ReactionType
  postId    String
  userId    String
  createdAt DateTime     @default(now())
  post      Post         @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId, type])
  @@index([postId])
  @@index([userId])
}

model AIQuery {
  id        String   @id @default(cuid())
  question  String
  response  String
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([createdAt])
}

model Subscription {
  id        String             @id @default(cuid())
  planType  PlanType
  status    SubscriptionStatus @default(ACTIVE)
  userId    String
  startedAt DateTime           @default(now())
  expiresAt DateTime?
  createdAt DateTime           @default(now())
  updatedAt DateTime           @updatedAt
  user      User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  type      String
  title     String
  message   String
  link      String?
  read      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read])
  @@index([createdAt])
}

model Conversation {
  id            String    @id @default(cuid())
  participants  String[]
  lastMessageAt DateTime  @default(now())
  createdAt     DateTime  @default(now())
  messages      Message[]

  @@index([participants])
  @@index([lastMessageAt])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  senderId       String
  content        String
  read           Boolean      @default(false)
  createdAt      DateTime     @default(now())
  attachments    Attachment[]
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([senderId])
  @@index([createdAt])
}

model Job {
  id              String           @id @default(cuid())
  title           String
  company         String
  companyLogo     String?
  location        String
  locationType    String
  jobType         String
  salaryMin       Int?
  salaryMax       Int?
  description     String
  requirements    String[]
  tags            String[]
  isPromoted      Boolean          @default(false)
  viewCount       Int              @default(0)
  postedById      String
  createdAt       DateTime         @default(now())
  expiresAt       DateTime?
  companyId       String?
  companyRelation Company?         @relation(fields: [companyId], references: [id])
  postedBy        User             @relation(fields: [postedById], references: [id], onDelete: Cascade)
  applications    JobApplication[]

  @@index([location])
  @@index([jobType])
  @@index([createdAt])
  @@index([postedById])
  @@index([companyId])
}

model Connection {
  id          String           @id @default(cuid())
  requesterId String
  receiverId  String
  status      ConnectionStatus @default(PENDING)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  receiver    User             @relation("ReceivedConnections", fields: [receiverId], references: [id], onDelete: Cascade)
  requester   User             @relation("SentConnections", fields: [requesterId], references: [id], onDelete: Cascade)

  @@unique([requesterId, receiverId])
  @@index([receiverId, status])
}

model CompanyFollow {
  id        String   @id @default(cuid())
  userId    String
  companyId String
  createdAt DateTime @default(now())
  company   Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, companyId])
  @@index([userId])
  @@index([companyId])
}

model Newsletter {
  id          String                   @id @default(cuid())
  title       String
  description String
  ownerId     String
  authorId    String
  logo        String?
  frequency   String                   @default("Weekly")
  createdAt   DateTime                 @default(now())
  updatedAt   DateTime                 @updatedAt
  owner       User                     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  subscribers NewsletterSubscription[]
  editions    Post[]

  @@index([ownerId])
}

model NewsletterSubscription {
  id           String     @id @default(cuid())
  userId       String
  newsletterId String
  createdAt    DateTime   @default(now())
  newsletter   Newsletter @relation(fields: [newsletterId], references: [id], onDelete: Cascade)
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, newsletterId])
  @@index([userId])
  @@index([newsletterId])
}

model Experience {
  id          String    @id @default(cuid())
  userId      String
  title       String
  company     String
  location    String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean   @default(false)
  description String?
  createdAt   DateTime  @default(now())
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Education {
  id           String    @id @default(cuid())
  userId       String
  school       String
  degree       String
  fieldOfStudy String?
  startDate    DateTime
  endDate      DateTime?
  createdAt    DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Event {
  id           String             @id @default(cuid())
  title        String
  description  String
  startTime    DateTime
  endTime      DateTime?
  location     String
  isOnline     Boolean            @default(true)
  link         String?
  groupId      String?
  organizerId  String
  companyId    String?
  createdAt    DateTime           @default(now())
  company      Company?           @relation(fields: [companyId], references: [id])
  group        Group?             @relation(fields: [groupId], references: [id])
  participants EventParticipant[]

  @@index([startTime])
  @@index([groupId])
}

model EventParticipant {
  id        String   @id @default(cuid())
  eventId   String
  userId    String
  status    String   @default("GOING")
  createdAt DateTime @default(now())
  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
}

model Poll {
  id          String       @id @default(cuid())
  question    String
  description String?
  groupId     String
  authorId    String
  expiresAt   DateTime?
  isMultiple  Boolean      @default(false)
  isClosed    Boolean      @default(false)
  createdAt   DateTime     @default(now())
  group       Group        @relation(fields: [groupId], references: [id], onDelete: Cascade)
  options     PollOption[]

  @@index([groupId])
  @@index([authorId])
}

model PollOption {
  id        String     @id @default(cuid())
  pollId    String
  text      String
  voteCount Int        @default(0)
  createdAt DateTime   @default(now())
  poll      Poll       @relation(fields: [pollId], references: [id], onDelete: Cascade)
  votes     PollVote[]

  @@index([pollId])
}

model PollVote {
  id        String     @id @default(cuid())
  optionId  String
  userId    String
  createdAt DateTime   @default(now())
  option    PollOption @relation(fields: [optionId], references: [id], onDelete: Cascade)

  @@unique([optionId, userId])
  @@index([userId])
}

model Report {
  id         String   @id @default(cuid())
  reporterId String
  targetId   String
  targetType String
  reason     String
  status     String   @default("PENDING")
  createdAt  DateTime @default(now())
  reporter   User     @relation(fields: [reporterId], references: [id])

  @@index([targetId])
  @@index([status])
}

model Endorsement {
  id         String   @id @default(cuid())
  userId     String
  endorserId String
  skill      String
  createdAt  DateTime @default(now())
  endorser   User     @relation("GivenEndorsements", fields: [endorserId], references: [id], onDelete: Cascade)
  user       User     @relation("ReceivedEndorsements", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, skill, endorserId])
  @@index([userId])
  @@index([endorserId])
}

model Recommendation {
  id         String   @id @default(cuid())
  receiverId String
  authorId   String
  content    String
  relation   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  author     User     @relation("GivenRecommendations", fields: [authorId], references: [id], onDelete: Cascade)
  receiver   User     @relation("ReceivedRecommendations", fields: [receiverId], references: [id], onDelete: Cascade)

  @@index([receiverId])
  @@index([authorId])
}

model Tag {
  id            String          @id @default(cuid())
  name          String          @unique
  displayName   String
  description   String?
  postCount     Int             @default(0)
  followerCount Int             @default(0)
  lastUsedAt    DateTime        @default(now())
  createdAt     DateTime        @default(now())
  posts         PostTag[]
  followers     UserTagFollow[]

  @@index([name])
  @@index([postCount])
  @@index([lastUsedAt])
}

model PostTag {
  id        String   @id @default(cuid())
  postId    String
  tagId     String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@index([postId])
  @@index([tagId])
}

model UserTagFollow {
  id        String   @id @default(cuid())
  userId    String
  tagId     String
  createdAt DateTime @default(now())
  tag       Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tagId])
  @@index([userId])
  @@index([tagId])
}

model SavedPost {
  id        String   @id @default(cuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
}

model Language {
  id          String   @id @default(cuid())
  userId      String
  language    String
  proficiency String
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Certification {
  id           String   @id @default(cuid())
  userId       String
  name         String
  organization String
  issueDate    String?
  credentialId String?
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Attachment {
  id        String   @id @default(cuid())
  url       String
  type      String
  name      String?
  size      Int?
  postId    String?
  messageId String?
  createdAt DateTime @default(now())
  message   Message? @relation(fields: [messageId], references: [id], onDelete: Cascade)
  post      Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([messageId])
}

model JobApplication {
  id          String            @id @default(cuid())
  jobId       String
  userId      String
  resumeUrl   String
  coverLetter String?
  status      ApplicationStatus @default(APPLIED)
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  job         Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobId, userId])
  @@index([jobId])
  @@index([userId])
}

model CareerInsight {
  id        String   @id @default(cuid())
  userId    String
  type      String
  content   Json
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model Badge {
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  icon        String?
  type        String
  levels      Json?
  createdAt   DateTime    @default(now())
  users       UserBadge[]
}

model UserBadge {
  id        String   @id @default(cuid())
  userId    String
  badgeId   String
  level     String?
  awardedAt DateTime @default(now())
  badge     Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
  @@index([badgeId])
}

enum UserRole {
  INDIVIDUAL
  COMPANY_ADMIN
  COMPANY_EMPLOYEE
  PLATFORM_ADMIN
}

enum PostType {
  CELEBRATION
  INSIGHT
  CASE_STUDY
  SOP
  INCIDENT
  COMPANY_UPDATE
  NEWSLETTER_EDITION
}

enum ReactionType {
  LIKE
  SAVE
}

enum PlanType {
  INDIVIDUAL_PREMIUM
  COMPANY_BASIC
  COMPANY_PRO
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
}

enum GroupType {
  PUBLIC
  PRIVATE
}

enum GroupRole {
  ADMIN
  MEMBER
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  IGNORED
}

enum ApplicationStatus {
  APPLIED
  REVIEWING
  INTERVIEWING
  REJECTED
  OFFERED
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  SHADOWBANNED
}
